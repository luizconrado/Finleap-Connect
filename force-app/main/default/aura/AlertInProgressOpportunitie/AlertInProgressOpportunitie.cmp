<aura:component implements="flexipage:availableForRecordHome,force:hasRecordId,force:hasSObjectName" controller="AlertController" access="global" >
    
    <aura:attribute name="OpportunityRecord" type="Object"/>
    <aura:attribute name="recordLoadError" type="String"/>
    <aura:attribute name="filterRecordType" type="boolean" default="false"/>

    <force:recordData aura:id="recordLoader"
                      recordId="{!v.recordId}"
                      fields="Name,AccountId,RecordTypeId,IsClosed"
                      targetFields="{!v.OpportunityRecord}"
                      targetError="{!v.recordLoadError}"
                      />
    <aura:handler name='change' value='{!v.OpportunityRecord}' action='{!c.checkInprogress}'/>
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <lightning:navigation aura:id="navService"/>
    
    
    <aura:handler name="RelatedList_viewAll" event="c:RelatedListEvent" action="{!c.viewAllInvoked}"/>
    <aura:handler name="RelatedList_openRecord" event="c:RelatedListEvent" action="{!c.openRecordInvoked}"/>
    
    <!--data attribute-->
    <aura:attribute name="opportunityList"  type="List" />
    <aura:attribute name="opportunityFieldsList" type="List" />
    <aura:attribute name="viewListData" type="List" />
    <aura:attribute name="viewAllListData" type="List" />
    

    <!--load attributs-->
    <aura:attribute name="isMobile" type="boolean" default="false" access="private"/>
    <aura:attribute name="loadView" type="boolean" default="false" />    
    <aura:attribute name="isViewAll" type="boolean" default="false" />
    <aura:attribute name="isViewRecord" type="boolean" default="false" />
	<aura:attribute name="filterRecordTypeExsists" type="boolean" default="false" />    
    
    <!--modal-attributes-->
    <aura:attribute name="viewHeader" type="string" />    
    <aura:attribute name="viewRecord" type="object"/>
    
    <!--popups-->
    <aura:if isTrue="{!v.isViewAll}">
        <c:Modal header="{!'All Opportunities ('+v.viewAllListData.length+')'}" open="{!v.isViewAll}" >
            <c:RelatedListItem sobjectName="Opportunity"  recordList="{!v.viewAllListData}" tileclass="slds-box" viewLength="{!v.viewAllListData.length}"></c:RelatedListItem>
        </c:Modal>
    </aura:if>
    <aura:if isTrue="{!v.isViewRecord}">
        <c:Modal header="{!v.viewHeader}" isLarge="true" open="{!v.isViewRecord}" >
            <c:FormLayout header="Opportunity Details" fieldsList="{!v.opportunityFieldsList}" record="{!v.viewRecord}" />
            <div class="slds-notify_container slds-is-relative">
                <div class="info-title slds-notify slds-notify_toast slds-theme_alert-texture slds-theme_warning" role="status">
                    {!$Label.c.Insufficient_Access_Text}
                </div>
            </div>
        </c:Modal>
    </aura:if>
    
    <!--alert-->
    <aura:if isTrue="{!v.loadView}">
        <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_info" role="alert">
            <span class="slds-assistive-text">info</span>
            <span class="{! join(' ',
                         'slds-icon_container slds-icon-utility-user slds-m-right_x-small',
                         (v.filterRecordTypeExsists?'no-access-color':'access-color')
                         )}" title="Warning">
                <lightning:icon iconName="utility:warning" size="x-small" alternativeText="{!v.filterRecordTypeExsists?'One or more open investment opportunities currently in progress.':'Warning'}" title="{!v.filterRecordTypeExsists?'One or more investment opportunites':'Warning'}" />
                
            </span>
            <h2>Parent account has one or more open opportunities currently in progress.
                <a href="javascript:void(0);" onclick="{!c.viewAllInvoked}">More Information</a>
            </h2>
        </div>
    </aura:if>
</aura:component>